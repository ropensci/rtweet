---
title: "Intro to rtweet: Collecting Twitter Data"
author: "Michael W. Kearney"
output:
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Intro to rtweet}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, eval = FALSE, comment = "#>", collapse = TRUE)
```

This vignette provides a quick tour of the R package `rtweet: Collecting Twitter Data`.

### Search tweets

Search for up to 18,000 (non-retweeted) tweets containing the rstats hashtag.
```{r, eval=FALSE}
## search for 18000 tweets using the rstats hashtag
rt <- search_tweets("#rstats", n = 18000, include_rts = FALSE)

## preview tweets data
rt

users_data(rt) # view users data

## plot time series (if ggplot2 is installed)
ts_plot(rt)
```


Quickly visualize frequency of tweets over time using `ts_plot()`.
```{r, eval=FALSE}
## plot time series of tweets
ts_plot(rt, "3 hours") +
  ggplot2::theme_minimal() +
  ggplot2::theme(plot.title = ggplot2::element_text(face = "bold")) +
  ggplot2::labs(
    x = NULL, y = NULL,
    title = "Frequency of #rstats Twitter statuses from past 9 days",
    subtitle = "Twitter status (tweet) counts aggregated using three-hour intervals",
    caption = "\nSource: Data collected from Twitter's REST API via rtweet"
  )
```

Twitter rate limits cap the number of search results returned to
18,000 every 15 minutes. To request more than that, simply set
`retryonratelimit = TRUE` and rtweet will wait for rate limit
resets for you.
```{r, eval=FALSE}
## search for 250,000 tweets containing the word data
rt <- search_tweets("data", n = 250000, retryonratelimit = TRUE)
```

Search by geo-location, for example, find 1000 tweets in the English
language sent from the United States.
```{r, eval=FALSE}
## search for 10,000 tweets sent from the US
geo_search <- search_tweets("lang:en", geocode = lookup_coords("usa"),
                            n = 1000)

## create lat/lng variables using all available tweet and profile geo-location data
geo_tweets <- lat_lng(geo_search)

## plot state boundaries
par(mar = c(0, 0, 0, 0))
if (requireNamespace("maps", quietly = TRUE)) {
  maps::map("state", lwd = .25)
}

## plot lat and lng points onto state map
points(geo_tweets$lng, geo_tweets$lat, pch = 20, cex = .75, 
       col = rgb(0, .3, .7, .75))
```

### Stream tweets

Randomly sample (approximately 1%) from the live stream of all tweets.
```{r, eval=FALSE}
## random sample for 30 seconds (default)
stream1 <- stream_tweets("")
```

Stream all geo enabled tweets from London for 60 seconds.
```{r, eval=FALSE}
## stream tweets from london for 60 seconds
stream_london <- stream_tweets(lookup_coords("london, uk"), timeout = 60)
```

Stream all tweets mentioning #rstats for a week.
```{r, eval=FALSE}
## stream london tweets for a week (60 secs x 60 mins * 24 hours *  7 days)
stream_rstats <- stream_tweets(
  "#rstats",
  timeout = 60 * 60 * 24 * 7,
  file_name = "tweets_about_R.json",
  parse = FALSE
)

## read in the data as a tidy tbl data frame
djt <- parse_stream("tweets_about_R.json.json")
```

### Get friends

Retrieve a list of all the accounts a **user follows**.
```{r, eval=FALSE}
## get user IDs of accounts followed by R Foundation
R_foundation_fds <- get_friends("_R_Foundation")

## lookup data on those accounts
R_foundation_fds_data <- lookup_users(R_foundation$user_id)
```

### Get followers

Retrieve a list of the **accounts following** a user.
```{r, eval=FALSE}
## get user IDs of accounts following R Foundation
R_foundation_flw <- get_followers("_R_Foundation", n = 75000)

## lookup data on those accounts
R_foundation_flw_data <- lookup_users(R_foundation_flw$user_id)
```

Or if you really want ALL of their followers:
```{r, eval=FALSE}
## how many total follows does R Foundation have?
R_foundation <- lookup_users("_R_Foundation")

## get them all (this would take a little over 5 days)
R_foundation_flw <- get_followers(
  "_R_Foundation", n = R_foundation$followers_count, retryonratelimit = TRUE
)
```

### Get timelines

Get the most recent 3,200 tweets from R Foundation.
```{r, eval=FALSE}
## get user IDs of accounts followed by R Foundation
tmls <- get_timelines("_R_Foundation", n = 3200)

## plot the frequency of tweets for each user over time
if (requireNamespace("dplyr", quietly = TRUE) && requireNamespace("ggplot2", quietly = TRUE)) {
  tmls %>%
    dplyr::filter(created_at > "2017-10-29") %>%
    dplyr::group_by(screen_name) %>%
    ts_plot("days", trim = 1L) +
    ggplot2::geom_point() +
    ggplot2::theme_minimal() +
    ggplot2::theme(
      legend.title = ggplot2::element_blank(),
      legend.position = "bottom",
      plot.title = ggplot2::element_text(face = "bold")) +
    ggplot2::labs(
      x = NULL, y = NULL,
      title = "Frequency of Twitter statuses posted by news organization",
      subtitle = "Twitter status (tweet) counts aggregated by day from October/November 2017",
      caption = "\nSource: Data collected from Twitter's REST API via rtweet"
    )
}
```

### Get favorites

Get the 3,000 most recently favorited statuses by R Foundation.
```{r, eval=FALSE}
RFoundation_favs <- get_favorites("_R_Foundation", n = 3000)
```

### Search users

Search for 1,000 users with the rstats hashtag in their profile bios.
```{r, eval=FALSE}
## search for users with #rstats in their profiles
useRs <- search_users("#rstats", n = 1000)
useRs
```

### Get trends

Discover what's currently trending in San Francisco.
```{r, eval=FALSE}
sf_trends <- get_trends("san francisco")
sf_trends
```

### Lookup users

```{r, eval=FALSE}
## lookup users by screen_name or user_id
users <- c("R_Foundation", "rOpenSci", "Bioconductor",
           "R_Contributors", "rstatstweet", "WeAreRLadies", "rstats_tweets",
           "rstats4ds", "CRANberriesfeed")
famous_tweeters <- lookup_users(users)

## preview users data
famous_tweeters

# extract most recent tweets data from the famous tweeters
tweets_data(famous_tweeters)
```


### Posting statuses

```{r, eval=FALSE}
id <- post_tweet("my first rtweet #rstats")

## save a png
x <- rnorm(300)
y <- x + rnorm(300, 0, .75)
tmp <- tempfile(fileext = ".png")
png(tmp, 6, 6, "in", res = 127.5)
plot(x, y, xlab = NULL, ylab = NULL, pch = 21, cex = 1,
     bg = bg, col = col,
     main = "This image was uploaded by rtweet")
grid(8, lwd = .15, lty = 2, col = "#00000088")
dev.off()

id <- post_tweet("my first rtweet #rstats", media = tmp, 
                 media_alt_text = "Random points generated by R to test posting media and alt text. Image posted with rtweet.")
```

### Following users

```{r, eval=FALSE}
## ty for the follow ;)
post_follow("kearneymw")
## Unfollow
post_follow("kearneymw", destroy = TRUE)
```
